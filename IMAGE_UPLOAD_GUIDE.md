# 图片上传功能使用指南

## 🖼️ 功能概述

F1历史上的今天管理系统现已支持图片上传功能，每条记录都可以上传多张图片，图片将存储在阿里云OSS中。

## 🚀 功能特性

### 图片上传
- **拖拽上传**：支持拖拽图片到上传区域
- **点击上传**：点击上传区域选择图片文件
- **多图支持**：每条记录可以上传多张图片
- **格式支持**：支持JPG、PNG、GIF等常见图片格式
- **大小限制**：单张图片最大5MB

### 图片管理
- **预览功能**：点击图片可查看大图
- **删除功能**：可单独删除某张图片
- **缩略图显示**：在记录中显示图片缩略图
- **OSS存储**：图片安全存储在阿里云OSS

## 📋 配置要求

### 1. 阿里云OSS配置

在 `server/env.example` 文件中配置您的阿里云OSS信息：

```bash
# 阿里云OSS配置
OSS_REGION=oss-cn-hangzhou
OSS_ACCESS_KEY_ID=your-access-key-id
OSS_ACCESS_KEY_SECRET=your-access-key-secret
OSS_BUCKET=your-bucket-name
OSS_ENDPOINT=https://oss-cn-hangzhou.aliyuncs.com
```

### 2. 创建环境变量文件

复制示例文件并填入您的实际配置：

```bash
cp server/env.example server/.env
```

然后编辑 `server/.env` 文件，填入您的实际OSS配置信息。

## 🎯 使用方法

### 新增帖子时上传图片

1. 点击右上角"新增帖子"按钮
2. 填写简介和选择日期
3. 在英文记录或中文记录中添加内容
4. 在每条记录下方找到"图片"区域
5. 点击或拖拽图片到上传区域
6. 上传成功后图片会显示为缩略图
7. 可以继续上传更多图片
8. 点击"保存"完成帖子创建

### 编辑帖子时管理图片

1. 在帖子列表中点击"编辑"按钮
2. 在抽屉中查看现有图片
3. 可以删除不需要的图片（点击图片右上角的删除按钮）
4. 可以添加新图片（拖拽或点击上传）
5. 点击"更新"保存修改

### 查看图片

1. **缩略图预览**：在记录中直接查看图片缩略图
2. **大图预览**：点击图片缩略图查看大图
3. **详情查看**：在帖子详情弹窗中查看所有图片

## 🔧 技术实现

### 后端实现

#### 数据库结构
```sql
-- 记录表新增images字段
ALTER TABLE records ADD COLUMN images TEXT;
```

#### 文件上传接口
```javascript
// POST /api/upload
// 支持多文件上传，返回OSS URL
```

#### OSS配置
```javascript
// 使用ali-oss SDK
// 自动生成唯一文件名
// 支持文件删除
```

### 前端实现

#### 图片上传组件
```javascript
// ImageUpload组件
// 支持拖拽上传
// 实时预览
// 删除功能
```

#### 记录表单
```javascript
// 每条记录都有独立的图片上传区域
// 支持多图片管理
```

## 📱 界面展示

### 上传区域
- 拖拽上传提示
- 上传进度显示
- 文件格式验证

### 图片预览
- 80x80像素缩略图
- 删除按钮（右上角）
- 预览按钮（右下角）

### 记录卡片
- 年份和内容输入
- 图片上传区域
- 删除记录按钮

## ⚠️ 注意事项

### 文件限制
- **格式限制**：只支持图片文件（JPG、PNG、GIF等）
- **大小限制**：单张图片最大5MB
- **数量限制**：每条记录最多10张图片

### 存储说明
- **OSS存储**：图片存储在阿里云OSS中
- **文件命名**：自动生成唯一文件名
- **访问权限**：OSS文件默认公开读取

### 安全考虑
- **文件验证**：服务端验证文件类型和大小
- **权限控制**：确保OSS配置安全
- **错误处理**：完善的错误提示机制

## 🛠️ 故障排除

### 常见问题

1. **上传失败**
   - 检查OSS配置是否正确
   - 确认网络连接正常
   - 验证文件格式和大小

2. **图片不显示**
   - 检查OSS文件是否存在
   - 确认OSS访问权限
   - 验证图片URL是否正确

3. **删除失败**
   - 检查OSS删除权限
   - 确认文件路径正确
   - 查看服务器日志

### 调试方法

1. **查看浏览器控制台**
   - 检查网络请求
   - 查看错误信息

2. **查看服务器日志**
   - 检查上传接口日志
   - 查看OSS操作日志

3. **测试OSS连接**
   - 使用OSS控制台测试
   - 验证配置信息

## 🎨 自定义配置

### 修改上传限制
```javascript
// 在server/index.js中修改
const upload = multer({
  limits: {
    fileSize: 10 * 1024 * 1024, // 修改为10MB
  },
  fileFilter: (req, file, cb) => {
    // 修改允许的文件类型
  }
});
```

### 修改图片预览大小
```javascript
// 在ImageUpload.js中修改
const ImageItem = styled.div`
  width: 100px;  // 修改缩略图大小
  height: 100px;
`;
```

### 修改OSS存储路径
```javascript
// 在config/oss.js中修改
const generateFileName = (originalName) => {
  return `custom-path/${timestamp}-${random}${ext}`;
};
```

## 📈 性能优化

### 图片压缩
- 建议上传前压缩图片
- 使用合适的图片格式
- 控制图片分辨率

### 加载优化
- 使用缩略图减少加载时间
- 实现懒加载机制
- 优化图片缓存策略

### 存储优化
- 定期清理无用图片
- 监控OSS存储使用量
- 优化文件命名策略 